<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Shopping List ðŸ›’</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#FFC0CB" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 1rem;
      background: linear-gradient(to bottom right, #FAD0C4, #FFD1DC);
      color: #333;
    }
    h1, h2 {
      text-align: center;
      color: #E75480;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .section-container {
      max-width: 600px;
      margin: 1rem auto;
      background: #FFFFFF;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: none;
    }
    .section-container.active {
        display: block;
    }
    label {
      display: block;
      margin-top: 0.75rem;
      font-weight: bold;
      color: #6A057F;
    }
    input, button, select {
      width: 100%;
      padding: 0.7rem;
      margin-top: 0.4rem;
      border: 1px solid #DDA0DD;
      border-radius: 0.5rem;
      box-sizing: border-box;
      color: #333;
      font-size: 1rem;
    }
    button {
      background: #FF69B4;
      color: #FFFFFF;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button:hover {
      background: #C71585;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    select {
        background: #F8F8FF;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;utf8,<svg fill='%23C71585' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
        background-repeat: no-repeat;
        background-position: right 0.7em top 50%;
        background-size: 0.65em auto;
        padding-right: 2.5em;
    }

    /* Styles for navigation buttons */
    .navigation-buttons {
        text-align: center;
        margin-bottom: 2rem;
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        flex-wrap: wrap;
    }
    .navigation-buttons button {
        width: auto;
        padding: 0.8rem 1.8rem;
        font-size: 1.1rem;
        background-color: #EE82EE;
        color: #FFFFFF;
        border: 2px solid #DA70D6;
        border-radius: 25px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        display: inline-flex; /* Use flex to align icon and text */
        align-items: center;
        justify-content: center;
    }
    .navigation-buttons button.active {
        background: #FFD700;
        color: #6A057F;
        border-color: #FFA500;
        font-weight: bold;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .navigation-buttons button:hover:not(.active) {
        background-color: #DDA0DD;
        border-color: #BA55D3;
    }
    .navigation-buttons button i {
        margin-right: 0.5rem;
    }
    .navigation-buttons button#toggleOptions {
        background: #FF6347;
        border-color: #FF4500;
    }
    .navigation-buttons button#toggleOptions:hover {
        background: #CD5C5C;
        border-color: #DC143C;
    }
    .navigation-options {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out;
        padding: 0 1rem;
        text-align: center;
    }
    .navigation-options.show-options {
        max-height: 200px; /* Adjust based on content */
        padding: 1rem;
    }

    /* Shopping List Section */
    #shoppingList {
        padding: 1rem;
    }
    #itemForm {
        display: flex;
        flex-direction: column;
        gap: 0.7rem;
        margin-bottom: 1.5rem;
    }
    #itemForm input[type="text"], #itemForm input[type="number"], #itemForm select {
        padding: 0.8rem;
        border: 1px solid #DDA0DD;
        border-radius: 0.5rem;
    }
    #itemForm button {
        padding: 0.8rem;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        font-size: 1rem;
    }
    #itemForm button:hover {
        background: #45a049;
    }
    #shoppingList ul {
        list-style: none;
        padding: 0;
    }
    #shoppingList li {
        background: #F0F8FF;
        border: 1px solid #E0BBE4;
        padding: 0.8rem 1rem;
        margin-bottom: 0.6rem;
        border-radius: 0.7rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    #shoppingList li:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    #shoppingList li.purchased {
        text-decoration: line-through;
        color: #888;
        background-color: #E8E8E8;
    }
    .item-info {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }
    .item-info strong {
        color: #6A057F;
    }
    .item-info span {
        font-size: 0.9em;
        color: #555;
    }
    .item-actions {
        display: flex;
        gap: 0.5rem;
    }
    .item-actions button {
        width: auto;
        padding: 0.4rem 0.7rem;
        border-radius: 0.4rem;
        font-size: 0.8rem;
    }
    .item-actions .purchase-btn {
        background: #8A2BE2;
    }
    .item-actions .purchase-btn:hover {
        background: #6A057F;
    }
    .item-actions .delete-btn {
        background: #FF4500;
    }
    .item-actions .delete-btn:hover {
        background: #DC143C;
    }
    .item-actions .edit-btn {
        background: #FFD700;
        color: #6A057F;
    }
    .item-actions .edit-btn:hover {
        background: #FFA500;
    }

    /* Suggestions Section */
    #suggestions {
        padding: 1rem;
    }
    #suggestionList ul {
        list-style: none;
        padding: 0;
    }
    #suggestionList li {
        background: #F0F8FF;
        border: 1px solid #E0BBE4;
        padding: 0.8rem 1rem;
        margin-bottom: 0.6rem;
        border-radius: 0.7rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    #suggestionList li button {
        width: auto;
        padding: 0.4rem 0.7rem;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 0.4rem;
        cursor: pointer;
    }
    #suggestionList li button:hover {
        background: #45a049;
    }

    /* Buy Later Section */
    #buyLater {
        padding: 1rem;
    }
    #buyLaterList ul {
        list-style: none;
        padding: 0;
    }
    #buyLaterList li {
        background: #F0F8FF;
        border: 1px solid #E0BBE4;
        padding: 0.8rem 1rem;
        margin-bottom: 0.6rem;
        border-radius: 0.7rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    #buyLaterList li button {
        width: auto;
        padding: 0.4rem 0.7rem;
        background: #FF69B4;
        color: white;
        border: none;
        border-radius: 0.4rem;
        cursor: pointer;
    }
    #buyLaterList li button:hover {
        background: #C71585;
    }

    /* Categories Section */
    #categories {
        padding: 1rem;
    }
    #categoryList ul {
        list-style: none;
        padding: 0;
    }
    #categoryList li {
        background: #F0F8FF;
        border: 1px solid #E0BBE4;
        padding: 0.8rem 1rem;
        margin-bottom: 0.6rem;
        border-radius: 0.7rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    #categoryList li button {
        background: #FF4500;
    }
    #categoryList li button:hover {
        background: #DC143C;
    }
    #addCategoryForm button {
        background: #20B2AA;
    }
    #addCategoryForm button:hover {
        background: #008B8B;
    }
    .category-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
    }
    .category-item .category-name {
        flex-grow: 1;
        cursor: grab;
        padding: 0.5rem;
    }
    .category-item .category-actions {
        display: flex;
        gap: 0.5rem;
    }
    .category-item .category-actions button {
        width: auto;
        padding: 0.4rem 0.7rem;
        border-radius: 0.4rem;
        font-size: 0.8rem;
    }
    .category-item .category-actions .move-btn {
        background: #1E90FF;
    }
    .category-item .category-actions .move-btn:hover {
        background: #007BFF;
    }
  </style>
</head>
<body>
  <h1>My Shopping List ðŸ›’</h1>

  <nav class="navigation-buttons">
    <button id="shoppingListBtn" class="active"><i class="fas fa-shopping-basket"></i> Ma Liste</button>
    <button id="suggestionsBtn"><i class="fas fa-lightbulb"></i> Suggestions</button>
    <button id="buyLaterBtn"><i class="fas fa-clock"></i> Acheter Plus Tard</button>
    <button id="toggleOptions"><i class="fas fa-chevron-down toggle-icon"></i> Options</button>
  </nav>

  <div class="navigation-options">
    <nav class="navigation-buttons">
        <button id="categoriesBtn"><i class="fas fa-tags"></i> CatÃ©gories</button>
        <button id="settingsBtn"><i class="fas fa-cog"></i> ParamÃ¨tres</button>
    </nav>
  </div>

  <div id="shoppingList" class="section-container active">
    <h2>Ma Liste de Courses</h2>
    <form id="itemForm">
      <input type="text" id="itemName" placeholder="Nom de l'article" required />
      <input type="number" id="itemQuantity" placeholder="QuantitÃ©" value="1" min="1" />
      <select id="itemCategory">
        <option value="">SÃ©lectionner une catÃ©gorie</option>
      </select>
      <button type="submit"><i class="fas fa-plus"></i> Ajouter Ã  la liste</button>
    </form>
    <ul id="shoppingListItems">
      </ul>
  </div>

  <div id="suggestions" class="section-container">
    <h2>Suggestions d'Articles</h2>
    <input type="text" id="suggestionSearch" placeholder="Rechercher des suggestions..." />
    <ul id="suggestionList">
      </ul>
  </div>

  <div id="buyLater" class="section-container">
    <h2>Articles Ã  Acheter Plus Tard</h2>
    <ul id="buyLaterList">
      </ul>
  </div>

  <div id="categories" class="section-container">
    <h2>GÃ©rer les CatÃ©gories</h2>
    <form id="addCategoryForm">
      <input type="text" id="newCategoryName" placeholder="Nouvelle catÃ©gorie" required />
      <button type="submit"><i class="fas fa-plus"></i> Ajouter CatÃ©gorie</button>
    </form>
    <ul id="categoryList">
      </ul>
  </div>

  <div id="settings" class="section-container">
    <h2>ParamÃ¨tres</h2>
    <p>GÃ©rez les options de votre application ici.</p>
    </div>

  <script type="module">
    // Supabase Initialization
    // Import the createClient function from the Supabase JS library as an ES module
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Remplacez avec votre Supabase URL et Anon Key
    const SUPABASE_URL = 'https://cepqcretnxfhjbvdukkk.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlcHFjcmV0bnhmaGpidmR1a2trIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2MTc1NDcsImV4cCI6MjA2NjE5MzU0N30.H56IGRN14FpfHXQVODKsmTbqMEe27_gcCcgGLphEEOU';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    // Fin de l'initialisation Supabase

    const shoppingListBtn = document.getElementById('shoppingListBtn');
    const suggestionsBtn = document.getElementById('suggestionsBtn');
    const buyLaterBtn = document.getElementById('buyLaterBtn');
    const categoriesBtn = document.getElementById('categoriesBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const toggleOptionsIcon = document.querySelector('#toggleOptions .toggle-icon');
    const navigationButtonsContainer = document.querySelector('.navigation-options');
    const allSectionContainers = document.querySelectorAll('.section-container');
    const shoppingListSection = document.getElementById('shoppingList');
    const itemForm = document.getElementById('itemForm'); // Get the item form
    const itemNameInput = document.getElementById('itemName');
    const itemQuantityInput = document.getElementById('itemQuantity');
    const itemCategorySelect = document.getElementById('itemCategory');
    const shoppingListItemsUl = document.getElementById('shoppingListItems');

    // Function to show a specific section and hide others
    function showSection(sectionId) {
        allSectionContainers.forEach(container => {
            container.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');

        // Update active button state
        const allNavButtons = document.querySelectorAll('.navigation-buttons button');
        allNavButtons.forEach(button => {
            button.classList.remove('active');
        });
        if (sectionId === 'shoppingList') {
            shoppingListBtn.classList.add('active');
        } else if (sectionId === 'suggestions') {
            suggestionsBtn.classList.add('active');
        } else if (sectionId === 'buyLater') {
            buyLaterBtn.classList.add('active');
        } else if (sectionId === 'categories') {
            categoriesBtn.classList.add('active');
        } else if (sectionId === 'settings') {
            settingsBtn.classList.add('active');
        }
    }

    // Event Listeners for navigation buttons
    shoppingListBtn.addEventListener('click', () => showSection('shoppingList'));
    suggestionsBtn.addEventListener('click', () => showSection('suggestions'));
    buyLaterBtn.addEventListener('click', () => showSection('buyLater'));
    categoriesBtn.addEventListener('click', () => showSection('categories'));
    settingsBtn.addEventListener('click', () => showSection('settings'));

    // Toggle options for navigation
    document.getElementById('toggleOptions').addEventListener('click', () => {
        const isShowing = navigationButtonsContainer.classList.contains('show-options');
        if (!isShowing) {
            navigationButtonsContainer.classList.add('show-options');
            toggleOptionsIcon.classList.remove('fa-chevron-down');
            toggleOptionsIcon.classList.add('fa-chevron-up');
        } else {
            navigationButtonsContainer.classList.remove('show-options');
            toggleOptionsIcon.classList.remove('fa-chevron-up');
            toggleOptionsIcon.classList.add('fa-chevron-down');
            // If the current section is one of the hidden ones, switch to "My List"
            if (!shoppingListSection.classList.contains('active')) {
                showSection('shoppingList');
            }
        }
    });

    // Fonctions pour interagir avec Supabase - DÃ©commentez et adaptez selon votre schÃ©ma de base de donnÃ©es
    function setupRealtimeListener() {
        console.log("Setting up Supabase Realtime listener...");
        // Exemple : Ã‰coutez les changements dans une table 'shopping_items'
        /*
        supabase.channel('public:shopping_items')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'shopping_items' }, payload => {
                console.log('Changement reÃ§u !', payload);
                loadShoppingList(); // Recharge la liste en cas de changement
            })
            .subscribe();
        */
    }

    async function loadShoppingList() {
        console.log("Loading shopping list...");
        // Exemple : RÃ©cupÃ©rez les articles de la table 'shopping_items'
        /*
        const { data, error } = await supabase
            .from('shopping_items')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error('Erreur lors du chargement de la liste de courses :', error.message);
            return;
        }

        shoppingListItemsUl.innerHTML = ''; // Efface la liste actuelle
        data.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `
                <div class="item-info">
                    <strong>${item.name}</strong>
                    <span>QuantitÃ©: ${item.quantity} ${item.category ? `(${item.category})` : ''}</span>
                </div>
                <div class="item-actions">
                    <button class="purchase-btn" data-id="${item.id}">${item.purchased ? 'DÃ©jÃ  achetÃ©' : 'Acheter'}</button>
                    <button class="edit-btn" data-id="${item.id}">Modifier</button>
                    <button class="delete-btn" data-id="${item.id}">Supprimer</button>
                </div>
            `;
            // Ajoutez des Ã©couteurs d'Ã©vÃ©nements pour les boutons d'achat/suppression/modification
            li.querySelector('.purchase-btn').addEventListener('click', async (e) => {
                const itemId = e.target.dataset.id;
                const { data: updatedItem, error: updateError } = await supabase
                    .from('shopping_items')
                    .update({ purchased: !item.purchased })
                    .eq('id', itemId);
                if (updateError) console.error('Erreur lors de la mise Ã  jour de l\'article :', updateError.message);
                else loadShoppingList(); // Recharge la liste
            });
            li.querySelector('.delete-btn').addEventListener('click', async (e) => {
                const itemId = e.target.dataset.id;
                const { error: deleteError } = await supabase
                    .from('shopping_items')
                    .delete()
                    .eq('id', itemId);
                if (deleteError) console.error('Erreur lors de la suppression de l\'article :', deleteError.message);
                else loadShoppingList(); // Recharge la liste
            });
            // Ajoutez la fonctionnalitÃ© d'Ã©dition ici
            shoppingListItemsUl.appendChild(li);
        });
        */
    }

    function updateAllCategorySelects() {
        console.log("Updating category selects...");
        // Logique pour populer le sÃ©lecteur itemCategory avec les catÃ©gories
        // Exemple :
        // const categories = JSON.parse(localStorage.getItem('user_categories') || '[]');
        // itemCategorySelect.innerHTML = '<option value="">SÃ©lectionner une catÃ©gorie</option>';
        // categories.forEach(cat => {
        //     const option = document.createElement('option');
        //     option.value = cat;
        //     option.textContent = cat;
        //     itemCategorySelect.appendChild(option);
        // });
    }

    function loadSuggestions() {
        console.log("Loading suggestions...");
        // Logique pour charger les suggestions
    }

    function loadBuyLaterList() {
        console.log("Loading buy later list...");
        // Logique pour charger les articles Ã  acheter plus tard
    }

    function loadCategoryOrder() {
        console.log("Loading category order...");
        // Logique pour charger et appliquer l'ordre des catÃ©gories
    }

    const initialDefaultCategories = ['Fruits & LÃ©gumes', 'Produits Laitiers', 'Viandes & Poissons', 'Boulangerie', 'Ã‰picerie', 'SurgelÃ©s', 'Boissons', 'Maison & Entretien', 'HygiÃ¨ne & BeautÃ©', 'Autres'];
    function getCategories() {
        return JSON.parse(localStorage.getItem('user_categories') || '[]');
    }

    // GÃ©rer l'ajout de nouveaux articles Ã  la liste
    itemForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // EmpÃªche la soumission par dÃ©faut du formulaire

        const itemName = itemNameInput.value.trim();
        const itemQuantity = parseInt(itemQuantityInput.value, 10);
        const itemCategory = itemCategorySelect.value;

        if (!itemName) {
            alert("Veuillez entrer le nom de l'article.");
            return;
        }

        try {
            // Exemple : InsÃ©rez des donnÃ©es dans une table 'shopping_items' dans Supabase
            // Assurez-vous que votre table 'shopping_items' existe dans Supabase
            // et a des colonnes 'name', 'quantity', 'category', 'purchased'.
            /*
            const { data, error } = await supabase
                .from('shopping_items') // Remplacez 'shopping_items' par le nom de votre table
                .insert([
                    { name: itemName, quantity: itemQuantity, category: itemCategory, purchased: false }
                ]);

            if (error) {
                console.error('Erreur lors de l\'ajout de l\'article :', error.message);
                alert("Erreur lors de l'ajout de l'article : " + error.message);
            } else {
                console.log('Article ajoutÃ© avec succÃ¨s :', data);
                itemNameInput.value = ''; // Efface le champ de saisie
                itemQuantityInput.value = '1'; // RÃ©initialise la quantitÃ©
                itemCategorySelect.value = ''; // RÃ©initialise la catÃ©gorie
                loadShoppingList(); // Recharge la liste de courses pour afficher le nouvel article
            }
            */
            alert(`Article ajoutÃ© (non sauvegardÃ© car Supabase non configurÃ©) : ${itemName}, QuantitÃ© : ${itemQuantity}, CatÃ©gorie : ${itemCategory}`);
            itemNameInput.value = '';
            itemQuantityInput.value = '1';
            itemCategorySelect.value = '';
        } catch (e) {
            console.error("Une erreur inattendue est survenue :", e);
            alert("Une erreur inattendue est survenue.");
        }
    });

    // --- Initialisation au chargement de la page ---
    window.addEventListener('load', () => {
      if (!localStorage.getItem('user_categories')) {
          localStorage.setItem('user_categories', JSON.stringify(initialDefaultCategories));
      }
      if (!localStorage.getItem('category_order')) {
          localStorage.setItem('category_order', JSON.stringify(getCategories()));
      }

      updateAllCategorySelects();
      loadSuggestions();
      loadBuyLaterList();
      loadCategoryOrder();

      // IMPORTANT : Initialise le listener Realtime de Supabase
      setupRealtimeListener();
      loadShoppingList(); // Charge la liste initiale une fois que le listener est configurÃ©

      showSection('shoppingList');
      // S'assurer que les options sont cachÃ©es au chargement initial et que la flÃ¨che pointe vers le bas
      navigationButtonsContainer.classList.remove('show-options');
      toggleOptionsIcon.classList.remove('fa-chevron-up');
      toggleOptionsIcon.classList.add('fa-chevron-down');
    });
  </script>
</body>
</html>